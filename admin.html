<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin — Mallard Court Office Entry Log</title>
<link rel="stylesheet" href="style.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDP-AOQt7L4ynAl4prxwGlYMy4GJYBImXc",
    authDomain: "mallardcourtlog.firebaseapp.com",
    projectId: "mallardcourtlog",
    storageBucket: "mallardcourtlog.firebasestorage.app",
    messagingSenderId: "200747477687",
    appId: "1:200747477687:web:2aa3d097a204232f08fb32"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const ADMIN_PASSWORD = 'nfks2312';

  document.addEventListener('DOMContentLoaded', () => {
    const loginBtn = document.getElementById('loginBtn');
    const loginMsg = document.getElementById('loginMsg');
    const loginCard = document.getElementById('loginCard');
    const adminPanel = document.getElementById('adminPanel');

    loginBtn.addEventListener('click', () => {
      const pass = document.getElementById('adminPass').value;
      if(pass === ADMIN_PASSWORD){
        loginCard.style.display='none';
        adminPanel.style.display='block';
        startAdminLog();
      } else {
        loginMsg.textContent = '❌ Incorrect password';
        setTimeout(() => loginMsg.textContent='', 2000);
      }
    });

    function startAdminLog(){
      const q = query(collection(db,'checkins'), orderBy('ts','desc'));
      onSnapshot(q, snapshot => {
        const entries = [];
        snapshot.forEach(doc => entries.push({...doc.data(), id: doc.id}));
        renderEntries(entries);
      });
    }

    function renderEntries(entries){
      const container = document.getElementById('entriesContainer');
      if(!entries.length){ container.innerHTML='<p class="help">No entries yet.</p>'; return; }
      let html='<table class="entries"><thead><tr><th>#</th><th>Name</th><th>SAP Number</th><th>Timestamp</th><th>Lat</th><th>Lon</th><th>Distance</th></tr></thead><tbody>';
      entries.forEach((e,i)=>{
        const latView = e.lat ? e.lat.toFixed(6) : '';
        const lonView = e.lon ? e.lon.toFixed(6) : '';
        const distView = (typeof e.distance_m==='number') ? (e.distance_m+' m') : '';
        html += `<tr><td>${i+1}</td><td>${e.name}</td><td>${e.sap}</td><td>${new Date(e.ts).toLocaleString()}</td><td>${latView}</td><td>${lonView}</td><td>${distView}</td></tr>`;
      });
      html+='</tbody></table>';
      container.innerHTML = html;
    }
  });
</script>
</head>
<body>
<header class="header">
  <img src="logo.png" alt="Company Logo" class="logo" />
  <h1>Admin — Mallard Court Office Entry Log</h1>
</header>

<main class="container">
<section class="card" id="loginCard">
  <label for="adminPass">Enter admin password</label>
  <input id="adminPass" type="password" placeholder="Password" />
  <button id="loginBtn">Unlock Log</button>
  <div id="loginMsg" class="status"></div>
</section>

<section class="card" id="adminPanel" style="display:none;">
  <div id="entriesContainer" class="entriesContainer"></div>
</section>
</main>

<footer class="footer">
<small><a href="index.html">Back to check-in page</a></small>
</footer>
</body>
</html>
